# シンプル雑貨オンライン詳細設計書（必須機能のみ）

※本バージョンは、基本設計の中から必須機能（商品閲覧、カート操作、非会員としての注文確定）の実装に絞った構成としています。

| ドキュメントバージョン | 1.0                                   |
| :------------------- | :------------------------------------ |
| 作成日               | 2025年O月O日                          |
| 作成チーム           | チームneko                            |
| 更新履歴             | 2025/O/O: Ver.1.0 初版作成 (チームneko) |

## 1. はじめに

### 1.1. 本書の目的

### 1.2. 前提となる基本設計書

### 1.3. 対象読者

### 1.4. 参考文献

## 2. システム概要

**システム構成（再掲）**

## 3. 機能仕様

### 3.1. 機能一覧

### 3.2. 機能詳細

#### 3.2.1. 商品一覧表示機能 (F02)

**補足:**

#### 3.2.2. 商品詳細表示機能 (F03)

#### 3.2.3. カート追加機能 (F04)

**補足:**

#### 3.2.4. カート表示・編集機能 (F05)

**カート情報取得 (GET /api/cart)**

**カート数量変更 (PUT /api/cart/items/{itemId})**

#### 3.2.5. 注文確定処理 (F08)

**補足:**

## 4. クラス設計
本章では、「ECサイト構築プロジェクト」バックエンド（Spring Boot）アプリケーションのクラス構造について定義する。主要なパッケージ構成、クラス図、主要クラスの説明、およびデータ転送オブジェクト（DTO）の定義を示す。


### 4.1. 主要パッケージ構成
ソースコードの整理と保守性向上のため、以下のパッケージ構成を採用する。
ルートパッケージは com.example.ecsite とする。

```
com.example.ecsite
├── EcSiteApplication.java    // Spring Boot起動クラス
│
├── controller                 // REST APIエンドポイント
│   ├── ProductController.java
│   ├── CartController.java
│   ├── OrderController.java
│   ├── AuthController.java          // 会員登録・ログイン
│   └── AdminController.java         // 管理者画面API
│
├── service                    // ビジネスロジック
│   ├── ProductService.java
│   ├── CartService.java
│   ├── OrderService.java
│   ├── AuthService.java
│   └── AdminService.java
│
├── repository                 // Spring Data JPAインターフェース
│   ├── ProductRepository.java
│   ├── OrderRepository.java
│   ├── OrderDetailRepository.java
│   ├── UserRepository.java
│   └── AdminRepository.java
│
├── entity                     // JPAエンティティ
│   ├── Product.java
│   ├── Order.java
│   ├── OrderDetail.java
│   ├── User.java
│   └── Admin.java
│
├── dto                        // DTO (API入出力・レイヤー間転送)
│   ├── product
│   │   ├── ProductListItem.java
│   │   └── ProductDetail.java
│   ├── cart
│   │   ├── Cart.java
│   │   └── CartItem.java
│   ├── order
│   │   ├── OrderRequest.java
│   │   ├── OrderResponse.java
│   │   └── CustomerInfo.java
│   └── auth
│       ├── LoginRequest.java
│       ├── RegisterRequest.java
│       └── AuthResponse.java
│
├── exception                  // グローバル例外処理
│   └── GlobalExceptionHandler.java
│
└── config
    └── SecurityConfig.java    // 認証・セキュリティ設定
```


### 4.2. クラス図

#### 4.2.1. 商品関連クラス図

<div class="mermaid">
classDiagram
    class ProductController {
        +ProductService productService
        +getAllProducts()
        +getProductById()
    }
    class ProductService {
        +ProductRepository productRepository
        +findAllProducts()
        +findProductById()
    }
    class ProductRepository {
        <<interface>>
        +findAll()
        +findById()
    }
    class Product {
        <<Entity>>
        +productId: Integer
        +name: String
        +description: String
        +price: Integer
        +stock: Integer
        +imageUrl: String
    }
    class ProductListItem {
        <<DTO>>
        +productId: Integer
        +name: String
        +price: Integer
        +imageUrl: String
    }
    class ProductDetail {
        <<DTO>>
        +productId: Integer
        +name: String
        +price: Integer
        +description: String
        +stock: Integer
        +imageUrl: String
    }

    ProductController --> ProductService
    ProductService --> ProductRepository
    ProductRepository --> Product
    ProductService ..> ProductListItem
    ProductService ..> ProductDetail
</div>

#### 4.2.2. カート関連クラス図 (セッション管理)

<div class="mermaid">
classDiagram
    class CartController {
        +CartService cartService
        +getCart()
        +addItem()
        +updateItem()
        +removeItem()
    }
    class CartService {
        +getCart()
        +addItemToCart()
        +updateItemQuantity()
        +removeItemFromCart()
    }
    class Cart {
        <<DTO>>
        +items: List~CartItem~
        +totalQuantity: Integer
        +totalPrice: Integer
    }
    class CartItem {
        <<DTO>>
        +productId: Integer
        +name: String
        +price: Integer
        +quantity: Integer
        +subtotal: Integer
    }

    CartController --> CartService
    CartService ..> Cart
    Cart ..> CartItem
</div>

#### 4.2.3. 注文関連クラス図 (非会員注文)
<div class="mermaid">
classDiagram
    class OrderController {
        +OrderService orderService
        +placeOrder()
    }
    class OrderService {
        +OrderRepository orderRepository
        +OrderDetailRepository orderDetailRepository
        +ProductRepository productRepository
        +placeOrder()
    }
    class OrderRepository {
        <<interface>>
        +save()
    }
    class OrderDetailRepository {
        <<interface>>
        +saveAll()
    }
    class Order {
        <<Entity>>
        +orderId: Integer
        +orderDate: LocalDateTime
        +totalAmount: Integer
        +status: String
    }
    class OrderDetail {
        <<Entity>>
        +orderDetailId: Integer
        +product: Product
        +price: Integer
        +quantity: Integer
    }
    class ProductRepository {
        <<interface>>
        +findById(): Optional~Product~
    }
    class Product {
        <<Entity>>
        +productId: Integer
        +name: String
        +price: Integer
        +stock: Integer
    }
    class OrderRequest {
        <<DTO>>
        +customerInfo: CustomerInfo
        +cartItems: List~CartItem~
    }
    class OrderResponse {
        <<DTO>>
        +orderId: Integer
        +orderDate: LocalDateTime
    }
    class CustomerInfo {
        <<DTO>>
        +name: String
        +address: String
        +phone: String
    }

    OrderController --> OrderService
    OrderService --> OrderRepository
    OrderService --> OrderDetailRepository
    OrderService --> ProductRepository
    Order --> OrderDetail
    OrderDetail --> Product
    OrderController ..> OrderRequest
    OrderController ..> OrderResponse


</div>

### 4.2.4. 認証（会員登録・ログイン）関連クラス図
<div class="mermaid">
classDiagram
    class AuthController {
        +AuthService authService
        +login()
        +register()
    }
    class AuthService {
        +UserRepository userRepository
        +registerUser()
        +loginUser()
    }
    class UserRepository {
        <<interface>>
        +findByEmail()
        +save()
    }
    class User {
        <<Entity>>
        +userId: Integer
        +name: String
        +email: String
        +password: String
        +address: String
    }
    class LoginRequest {
        <<DTO>>
        +email: String
        +password: String
    }
    class RegisterRequest {
        <<DTO>>
        +name: String
        +email: String
        +password: String
        +address: String
    }
    class AuthResponse {
        <<DTO>>
        +userId: Integer
        +name: String
    }

    AuthController --> AuthService
    AuthService --> UserRepository
    UserRepository --> User
    AuthController ..> LoginRequest
    AuthController ..> RegisterRequest
    AuthController ..> AuthResponse
</div>

### 4.3. 主要クラス説明
 - Controller:
   - ProductController, CartController, OrderController, AuthController を用意しREST APIエンドポイントを提供。
   - @RestController, @RequestMapping, @PostMapping, @GetMapping 等を使用。

 - Service:
   - ビジネスロジック（商品検索、カート管理、注文処理、認証管理）を集約。
   - @Service としてSpring管理対象とし、トランザクション管理は必要に応じて @Transactional で対応。

 - Repository:
   - JpaRepository を継承し、DBアクセスを抽象化。

 - Entity:
   - @Entity, @Id, @GeneratedValue, @Column でテーブルカラムにマッピング。
   - 商品、注文、注文詳細、ユーザー、管理者の5テーブルを想定。

- DTO:
  - レイヤー間・API入出力で使用。
  - 入力バリデーションは @Valid + DTO にアノテーション付与で対応予定。

#### 補足
**今後のAPI仕様書作成時:**
 - /api/products, /api/cart, /api/orders, /api/auth/register, /api/auth/login などのRESTエンドポイントを整理可能。

- ResponseEntity によりHTTPステータスコード・ヘッダ・ボディ返却を適切に管理。

**ログイン・認証管理:**
 - Spring Securityでセッション認証またはJWT化を検討（初期はセッションで開始可能）。

**管理者機能:**
 - 商品管理（CRUD）、在庫更新、注文ステータス更新を管理用APIで実装予定。


### 4.4. DTO定義
本システムでは、レイヤー間・API入出力のデータ授受にDTO（Data Transfer Object）を用います。以下に主要DTOの構造と利用目的を示します。

#### 4.4.1. 商品関連DTO
**ProductListItem.java**
商品一覧取得時に返却するシンプルな商品情報。

```java
public class ProductListItem {
    private Integer productId;
    private String name;
    private Integer price;
    private String imageUrl;
}
```

**ProductDetail.java**
商品詳細取得時に返却する詳細情報。

```java
public class ProductDetail {
    private Integer productId;
    private String name;
    private String description;
    private Integer price;
    private Integer stock;
    private String imageUrl;
}
```

#### 4.4.2. カート関連DTO
**Cart.java**
セッション保持・API返却用のカート全体情報。

```java
public class Cart {
    private List<CartItem> items;
    private Integer totalQuantity;
    private Integer totalPrice;
}
```

**CartItem.java**
カート内の商品情報。

```java
public class CartItem {
    private Integer productId;
    private String name;
    private Integer price;
    private Integer quantity;
    private Integer subtotal;
}
```

#### 4.4.3. 注文関連DTO
**OrderRequest.java**
注文確定時にフロントエンドから送信されるリクエスト。

```java
public class OrderRequest {
    private CustomerInfo customerInfo;
    private List<CartItem> cartItems;
}
```

**OrderResponse.java**
注文完了時に返却するレスポンス情報。

```java
public class OrderResponse {
    private Integer orderId;
    private LocalDateTime orderDate;
}
```

**CustomerInfo.java**
非会員注文時に入力する配送先・顧客情報

```java
public class CustomerInfo {
    private String name;
    private String email;
    private String address;
    private String phoneNumber;
}
```

#### 4.4.4. 認証関連DTO
**RegisterRequest.java**
会員登録時のリクエスト。

```java
public class RegisterRequest {
    private String name;
    private String email;
    private String password;
    private String address;
}
```

**LoginRequest.java**
ログイン時のリクエスト。

```java
public class LoginRequest {
    private String email;
    private String password;
}
```

**AuthResponse.java**
認証成功時に返却する情報。

```java
public class AuthResponse {
    private Integer userId;
    private String name;
}
```

#### 4.4.5. 管理者関連DTO（将来的拡張用）
（必要に応じて設計）

管理者用ログイン：AdminLoginRequest, AdminAuthResponse

商品管理API用DTO：ProductCreateRequest, ProductUpdateRequest

注文ステータス更新：OrderStatusUpdateRequest

